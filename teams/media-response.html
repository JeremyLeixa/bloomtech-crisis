<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Team - BloomTech Crisis Communication</title>
    <style>
        :root {
            --media-primary: #3b82f6;
            --media-secondary: #1d4ed8;
            --media-accent: #eff6ff;
            --dark-bg: #1f2937;
            --text-white: #f9fafb;
            --text-gray: #d1d5db;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --danger-red: #dc2626;
            --border-gray: #374151;
            --card-bg: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #0f172a 100%);
            color: var(--text-white);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--media-primary) 0%, var(--media-secondary) 100%);
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .team-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .crisis-timer {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .timer-item {
            text-align: center;
        }

        .timer-value {
            font-size: 2rem;
            font-weight: 700;
            display: block;
        }

        .timer-label {
            font-size: 0.75rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Status Bar */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .status-item {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--media-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .status-icon {
            font-size: 1.5rem;
        }

        .status-text {
            flex: 1;
        }

        .status-label {
            font-size: 0.875rem;
            color: var(--text-gray);
            margin-bottom: 0.25rem;
        }

        .status-value {
            font-weight: 600;
            color: var(--text-white);
        }

        /* Work Cards */
        .work-section {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .work-card {
            background: var(--card-bg);
            border-radius: 1rem;
            border: 1px solid var(--border-gray);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .work-card:hover {
            border-color: var(--media-primary);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .work-card.blocked-section {
            opacity: 0.6;
        }

        .work-card.blocked-section:hover {
            border-color: var(--border-gray);
            box-shadow: none;
        }

        .card-header {
            background: linear-gradient(135deg, var(--media-primary) 0%, var(--media-secondary) 100%);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-status {
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-blocked {
            background: var(--danger-red);
            color: white;
        }

        .status-available {
            background: var(--success-green);
            color: white;
        }

        .status-completed {
            background: var(--text-gray);
            color: var(--dark-bg);
        }

        .card-content {
            padding: 2rem;
        }

        /* Blocked Overlay */
        .blocked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(31, 41, 55, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            z-index: 10;
            transition: all 0.5s ease;
        }

        .blocked-overlay.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(-20px);
        }

        .blocked-message {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            max-width: 400px;
            border: 1px solid var(--border-gray);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .blocked-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--warning-orange);
        }

        .blocked-description {
            color: var(--text-gray);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Legal Guidelines Section */
        .legal-guidelines {
            background: var(--card-bg);
            border-radius: 1rem;
            border: 1px solid var(--success-green);
            overflow: hidden;
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .legal-guidelines.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .legal-guidelines .card-header {
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
        }

        .guidelines-content {
            padding: 2rem;
            display: grid;
            gap: 1.5rem;
        }

        .guideline-item {
            background: var(--dark-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-gray);
        }

        .guideline-item h4 {
            color: var(--success-green);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guideline-text {
            color: var(--text-gray);
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid var(--success-green);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }

        .approval-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .approval-status.approved {
            background: var(--success-green);
            color: white;
        }

        .approval-status.conditional {
            background: var(--warning-orange);
            color: white;
        }

        .approval-status.denied {
            background: var(--danger-red);
            color: white;
        }

        /* Form Elements */
        .media-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-group {
            display: grid;
            gap: 0.75rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-gray);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            background: var(--dark-bg);
            border: 1px solid var(--border-gray);
            border-radius: 0.5rem;
            padding: 0.875rem;
            color: var(--text-white);
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--media-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .form-textarea.large {
            min-height: 200px;
        }

        /* Press Release Editor */
        .press-editor {
            background: white;
            color: #1f2937;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--border-gray);
            margin: 1rem 0;
        }

        .press-header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .press-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .press-ref {
            font-size: 0.875rem;
            color: #6b7280;
            font-family: 'JetBrains Mono', monospace;
        }

        .press-content {
            line-height: 1.7;
            color: #374151;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--media-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--media-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: var(--dark-bg);
            color: var(--text-white);
            border: 1px solid var(--border-gray);
        }

        .btn-secondary:hover {
            background: var(--border-gray);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .slide-in {
            animation: slideInUp 0.6s ease;
        }

        .bounce-in {
            animation: bounceIn 0.8s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .crisis-timer {
                gap: 1rem;
            }

            .timer-value {
                font-size: 1.5rem;
            }

            .status-bar {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                justify-content: center;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--media-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.hide {
            transform: translateX(400px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="team-badge">
                    <span>📰</span>
                    <span>Media Response Team</span>
                </div>
                <h1>Crisis Communication</h1>
                <p>Manage BloomTech's public communication during the crisis. Control the narrative and protect brand reputation.</p>
                
                <div class="crisis-timer">
                    <div class="timer-item">
                        <span class="timer-value" id="globalTimer">90:00</span>
                        <span class="timer-label">Global Timer</span>
                    </div>
                    <div class="timer-item">
                        <span class="timer-value" id="pressDeadline">60:00</span>
                        <span class="timer-label">Press Deadline</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-icon">🔍</span>
                <div class="status-text">
                    <div class="status-label">Crisis Analysis</div>
                    <div class="status-value" id="crisisStatus">Pending</div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-icon">⚖️</span>
                <div class="status-text">
                    <div class="status-label">Legal Approval</div>
                    <div class="status-value" id="legalStatus">Waiting</div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-icon">📢</span>
                <div class="status-text">
                    <div class="status-label">Media Response</div>
                    <div class="status-value" id="mediaStatus">In Progress</div>
                </div>
            </div>
        </div>

        <!-- Legal Guidelines Section (Hidden initially) -->
        <div class="legal-guidelines" id="legalGuidelines">
            <div class="card-header">
                <h2 class="card-title">
                    <span>✅</span>
                    Legal Guidelines Received
                </h2>
                <div class="card-status status-available">APPROVED</div>
            </div>
            <div class="guidelines-content">
                <div class="guideline-item">
                    <h4>📢 Approved Key Messages</h4>
                    <div class="guideline-text" id="approvedMessages">Loading approved messaging from Legal Team...</div>
                </div>
                <div class="guideline-item">
                    <h4>🚫 Restricted Topics</h4>
                    <div class="guideline-text" id="restrictedTopics">Loading legal restrictions from Legal Team...</div>
                </div>
                <div class="approval-status approved" id="approvalStatus">
                    <span>✅</span>
                    <span>Full Approval - Proceed with Communication</span>
                </div>
            </div>
        </div>

        <!-- Work Section -->
        <div class="work-section">
            <!-- Press Release Card (Blocked initially) -->
            <div class="work-card blocked-section" id="pressReleaseCard">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>📄</span>
                        Official Press Release
                    </h2>
                    <div class="card-status status-blocked" id="pressStatus">BLOCKED</div>
                </div>
                <div class="card-content">
                    <div class="blocked-overlay" id="pressBlockedOverlay">
                        <div class="blocked-message">
                            <div class="blocked-title">
                                <span>⏳</span>
                                Waiting for Legal Position
                            </div>
                            <div class="blocked-description">
                                Cannot write official press release without legal team's approved position on FTC complaints and liability issues.
                            </div>
                        </div>
                    </div>

                    <div class="press-editor">
                        <div class="press-header">
                            <div class="press-title">FOR IMMEDIATE RELEASE</div>
                            <div class="press-ref">BloomTech Press Release | Crisis Response</div>
                        </div>
                        <div class="press-content" id="pressPreview">
                            <p><strong>Your press release content will appear here as you work on it...</strong></p>
                        </div>
                    </div>

                    <form class="media-form" id="pressReleaseForm">
                        <div class="form-group">
                            <label class="form-label">
                                <span>📰</span>
                                Press Release Status
                            </label>
                            <select class="form-select" id="pressReleaseStatus">
                                <option value="draft">Draft - Working on content</option>
                                <option value="review">Under Review - Content ready</option>
                                <option value="approved">Approved - Ready to publish</option>
                                <option value="published">Published - Live to media</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span>📝</span>
                                Content Notes
                            </label>
                            <textarea class="form-textarea" placeholder="Brief notes about your press release approach and key points addressed..." id="pressNotes"></textarea>
                        </div>

                        <div class="action-buttons">
                            <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                <span>💾</span>
                                Save Progress
                            </button>
                            <button type="button" class="btn btn-success" onclick="completePressRelease()">
                                <span>✅</span>
                                Complete Press Release
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Social Media Strategy Card -->
            <div class="work-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>📱</span>
                        Social Media Crisis Response
                    </h2>
                    <div class="card-status status-available">AVAILABLE</div>
                </div>
                <div class="card-content">
                    <form class="media-form" id="socialMediaForm">
                        <div class="form-group">
                            <label class="form-label">
                                <span>🎯</span>
                                Crisis Response Strategy
                            </label>
                            <select class="form-select" id="socialStrategy">
                                <option value="">Select social media approach...</option>
                                <option value="proactive">Proactive - Address issues head-on</option>
                                <option value="reactive">Reactive - Respond to comments only</option>
                                <option value="minimal">Minimal - Limited social presence</option>
                                <option value="pause">Pause - Temporary social silence</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span>📝</span>
                                Key Social Messages
                            </label>
                            <textarea class="form-textarea" placeholder="Draft key messages for social media posts (Twitter, Instagram, LinkedIn)..." id="socialMessages"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span>💬</span>
                                Community Management Plan
                            </label>
                            <textarea class="form-textarea" placeholder="How will you handle negative comments and customer complaints on social media?..." id="communityPlan"></textarea>
                        </div>

                        <div class="action-buttons">
                            <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                <span>💾</span>
                                Save Strategy
                            </button>
                            <button type="button" class="btn btn-primary" onclick="completeSocialMedia()">
                                <span>📱</span>
                                Complete Social Strategy
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Media Outreach Card -->
            <div class="work-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>📞</span>
                        Media Relations & Outreach
                    </h2>
                    <div class="card-status status-available">AVAILABLE</div>
                </div>
                <div class="card-content">
                    <form class="media-form" id="mediaOutreachForm">
                        <div class="form-group">
                            <label class="form-label">
                                <span>📋</span>
                                Priority Media Contacts
                            </label>
                            <textarea class="form-textarea" placeholder="List key journalists and media outlets to contact (TechCrunch, Forbes, industry publications)..." id="mediaContacts"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span>🎙️</span>
                                Interview Talking Points
                            </label>
                            <textarea class="form-textarea large" placeholder="Prepare key talking points for potential media interviews and press calls..." id="talkingPoints"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span>📊</span>
                                Media Monitoring Plan
                            </label>
                            <textarea class="form-textarea" placeholder="How will you track media coverage and sentiment during the crisis?..." id="monitoringPlan"></textarea>
                        </div>

                        <div class="action-buttons">
                            <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                                <span>💾</span>
                                Save Plan
                            </button>
                            <button type="button" class="btn btn-primary" onclick="completeMediaOutreach()">
                                <span>📞</span>
                                Complete Outreach Plan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        const mediaState = {
            legalApprovalReceived: false,
            pressReleaseComplete: false,
            socialMediaComplete: false,
            mediaOutreachComplete: false,
            startTime: Date.now(),
            pressDeadline: 60 * 60 * 1000, // 60 minutes
            globalDeadline: 90 * 60 * 1000 // 90 minutes
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeMediaInterface();
            startTimers();
            loadSavedData();
            scheduleJournalistPressure();
            
            // Vérification immédiate au cas où Legal aurait déjà terminé
            setTimeout(() => {
                checkLegalApprovalStatus();
            }, 1000);
        });

        function initializeMediaInterface() {
            console.log('[Media] Interface initialized');
            
            // Add auto-save to all textareas
            document.querySelectorAll('textarea, select').forEach(element => {
                element.addEventListener('input', function() {
                    saveDraft();
                });
            });
            
            // Add press release preview update
            setupPressPreview();
        }

        function setupPressPreview() {
            // Add event listeners for press release preview
            const pressNotes = document.getElementById('pressNotes');
            const pressStatus = document.getElementById('pressReleaseStatus');
            
            if (pressNotes) {
                pressNotes.addEventListener('input', updatePressPreview);
            }
            if (pressStatus) {
                pressStatus.addEventListener('change', updatePressPreview);
            }
            
            // Initial preview update
            updatePressPreview();
        }

        function updatePressPreview() {
            const pressNotes = document.getElementById('pressNotes')?.value || '';
            const pressStatus = document.getElementById('pressReleaseStatus')?.value || '';
            
            let preview = '<p><strong>FOR IMMEDIATE RELEASE</strong><br>BloomTech Crisis Response | ' + new Date().toLocaleDateString() + '</p>';
            
            if (pressNotes) {
                preview += '<hr style="margin: 1rem 0; border: 1px solid #e5e7eb;">';
                preview += `<p><strong>Crisis Response Summary:</strong></p>`;
                preview += `<p style="line-height: 1.6;">${pressNotes.replace(/\n/g, '<br>')}</p>`;
            }
            
            if (pressStatus && pressStatus !== 'draft') {
                preview += '<hr style="margin: 1rem 0; border: 1px solid #e5e7eb;">';
                preview += `<p style="font-style: italic; color: #6b7280;"><strong>Status:</strong> ${pressStatus.charAt(0).toUpperCase() + pressStatus.slice(1).replace('-', ' ')}</p>`;
            }
            
            if (mediaState.legalApprovalReceived) {
                preview += '<hr style="margin: 1rem 0; border: 1px solid #e5e7eb;">';
                preview += '<p style="font-size: 0.875rem; color: #059669;"><strong>✅ Legal Guidelines Applied</strong> - Communication approved for public release</p>';
            }
            
            if (!pressNotes && (!pressStatus || pressStatus === 'draft')) {
                preview = '<p><strong>Your press release content will appear here as you work on it...</strong></p>';
            }
            
            const pressPreview = document.getElementById('pressPreview');
            if (pressPreview) {
                pressPreview.innerHTML = preview;
            }
        }

        function checkLegalApprovalStatus() {
            const legalApprovalComplete = localStorage.getItem('legal_media_approval_complete');
            
            if (legalApprovalComplete === 'true' && !mediaState.legalApprovalReceived) {
                receiveLegalApproval();
                return; // Stop checking once received
            }
            
            // Continue checking every 3 seconds if not received yet
            if (!mediaState.legalApprovalReceived) {
                setTimeout(checkLegalApprovalStatus, 3000);
            }
        }

        // Ajouter les alertes journalistes
        function scheduleJournalistPressure() {
            // Alerte 1 - 90 secondes après l'ouverture
            setTimeout(() => {
                showNotification('📞 Breaking: Tech journalist from TechCrunch requesting immediate statement!');
            }, 90000);
            
            // Alerte 2 - 3 minutes
            setTimeout(() => {
                showNotification('📱 URGENT: Viral tweet gaining traction - need counter-narrative NOW!');
            }, 180000);
            
            // Alerte 3 - 5 minutes
            setTimeout(() => {
                showNotification('📺 CNN business reporter calling in 10 minutes for live segment!');
            }, 300000);
            
            // Alerte 4 - 8 minutes (si pas de Legal approval)
            setTimeout(() => {
                if (!mediaState.legalApprovalReceived) {
                    showNotification('⚠️ DEADLINE ALERT: Press conference in 20 minutes - need content NOW!');
                }
            }, 480000);
            
            // Alerte finale - 12 minutes
            setTimeout(() => {
                showNotification('🔥 VIRAL: #BloomTechFail trending on Twitter - immediate response required!');
            }, 720000);
        }

        function receiveLegalApproval() {
            if (mediaState.legalApprovalReceived) return;
            
            mediaState.legalApprovalReceived = true;
            
            // Update status bar
            document.getElementById('legalStatus').textContent = 'Approved';
            document.getElementById('legalStatus').style.color = '#10b981';
            
            // Load legal approval data
            let legalData = {
                approvedMessages: 'Legal guidelines not yet available...',
                restrictedTopics: 'Legal restrictions not yet available...',
                approvalStatus: 'approved'
            };
            
            // Try to get data from legal_media_approval_data (JSON format)
            const legalApprovalData = localStorage.getItem('legal_media_approval_data');
            if (legalApprovalData) {
                try {
                    const parsedData = JSON.parse(legalApprovalData);
                    legalData = {
                        approvedMessages: parsedData.approvedMessages || legalData.approvedMessages,
                        restrictedTopics: parsedData.restrictedTopics || legalData.restrictedTopics,
                        approvalStatus: parsedData.approvalStatus || legalData.approvalStatus
                    };
                } catch (e) {
                    console.warn('[Media] Could not parse legal_media_approval_data JSON:', e);
                }
            }
            
            // Show legal guidelines section with animation
            const guidelinesSection = document.getElementById('legalGuidelines');
            guidelinesSection.classList.add('visible', 'slide-in');
            
            // Populate guidelines content
            document.getElementById('approvedMessages').textContent = legalData.approvedMessages;
            document.getElementById('restrictedTopics').textContent = legalData.restrictedTopics;
            
            // Update approval status display
            const approvalStatusElement = document.getElementById('approvalStatus');
            if (legalData.approvalStatus === 'approved') {
                approvalStatusElement.className = 'approval-status approved';
                approvalStatusElement.innerHTML = '<span>✅</span><span>Full Approval - Proceed with Communication</span>';
            } else if (legalData.approvalStatus === 'conditional') {
                approvalStatusElement.className = 'approval-status conditional';
                approvalStatusElement.innerHTML = '<span>⚠️</span><span>Conditional Approval - Restrictions Apply</span>';
            } else if (legalData.approvalStatus === 'denied') {
                approvalStatusElement.className = 'approval-status denied';
                approvalStatusElement.innerHTML = '<span>❌</span><span>Communication Denied</span>';
            }
            
            // Unblock press release section with dramatic effect
            setTimeout(() => {
                unlockPressRelease();
            }, 800);
            
            // Show notification
            showNotification('✅ Legal approval received! Press Release section unlocked.');
            
            console.log('[Media] Legal approval received and processed:', legalData);
        }

        function unlockPressRelease() {
            const pressCard = document.getElementById('pressReleaseCard');
            const blockedOverlay = document.getElementById('pressBlockedOverlay');
            const pressStatus = document.getElementById('pressStatus');
            
            // Hide blocked overlay with animation
            blockedOverlay.classList.add('hidden');
            
            // Update card appearance
            pressCard.classList.remove('blocked-section');
            pressCard.classList.add('bounce-in');
            
            // Update status
            pressStatus.textContent = 'AVAILABLE';
            pressStatus.className = 'card-status status-available';
            
            console.log('[Media] Press Release section unlocked');
        }

        function startTimers() {
            setInterval(function() {
                const elapsed = Date.now() - mediaState.startTime;
                
                // Global timer (90 minutes)
                const globalRemaining = Math.max(0, mediaState.globalDeadline - elapsed);
                const globalMinutes = Math.floor(globalRemaining / 60000);
                const globalSeconds = Math.floor((globalRemaining % 60000) / 1000);
                document.getElementById('globalTimer').textContent = 
                    `${globalMinutes}:${globalSeconds.toString().padStart(2, '0')}`;
                
                // Press deadline timer (60 minutes)
                const pressRemaining = Math.max(0, mediaState.pressDeadline - elapsed);
                const pressMinutes = Math.floor(pressRemaining / 60000);
                const pressSecondsVal = Math.floor((pressRemaining % 60000) / 1000);
                document.getElementById('pressDeadline').textContent = 
                    `${pressMinutes}:${pressSecondsVal.toString().padStart(2, '0')}`;
                
                // Add urgency styling when time is running out
                if (pressRemaining < 300000) { // Less than 5 minutes
                    document.getElementById('pressDeadline').style.color = '#dc2626';
                }
            }, 1000);
        }

        function saveDraft() {
            const draftData = {
                pressNotes: document.getElementById('pressNotes')?.value || '',
                pressReleaseStatus: document.getElementById('pressReleaseStatus')?.value || '',
                socialStrategy: document.getElementById('socialStrategy')?.value || '',
                socialMessages: document.getElementById('socialMessages')?.value || '',
                communityPlan: document.getElementById('communityPlan')?.value || '',
                mediaContacts: document.getElementById('mediaContacts')?.value || '',
                talkingPoints: document.getElementById('talkingPoints')?.value || '',
                monitoringPlan: document.getElementById('monitoringPlan')?.value || '',
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('media_draft', JSON.stringify(draftData));
            console.log('[Media] Draft saved');
        }

        function loadSavedData() {
            const saved = localStorage.getItem('media_draft');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    Object.keys(data).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && key !== 'timestamp') {
                            element.value = data[key];
                        }
                    });
                } catch (e) {
                    console.warn('[Media] Could not load saved data:', e);
                }
            }
        }

        function completePressRelease() {
            const pressNotes = document.getElementById('pressNotes').value.trim();
            const pressStatus = document.getElementById('pressReleaseStatus').value;
            
            if (!pressNotes) {
                alert('Please add content notes about your press release approach before completing.');
                return;
            }
            
            if (pressStatus === 'draft') {
                alert('Please update the press release status to "Under Review" or higher before completing.');
                return;
            }
            
            mediaState.pressReleaseComplete = true;
            localStorage.setItem('media_press_release_complete', 'true');
            
            // Store press release data
            const pressData = {
                notes: pressNotes,
                status: pressStatus,
                completedAt: new Date().toISOString()
            };
            localStorage.setItem('media_press_release_data', JSON.stringify(pressData));
            
            // Update UI
            const pressCard = document.getElementById('pressReleaseCard');
            const statusBadge = pressCard.querySelector('.card-status');
            statusBadge.textContent = 'COMPLETED';
            statusBadge.className = 'card-status status-completed';
            
            // Disable form
            const form = document.getElementById('pressReleaseForm');
            const inputs = form.querySelectorAll('input, textarea, select, button');
            inputs.forEach(input => input.disabled = true);
            
            showNotification('✅ Press Release completed successfully!');
            updateOverallStatus();
            
            console.log('[Media] Press Release completed');
        }

        function completeSocialMedia() {
            const strategy = document.getElementById('socialStrategy').value;
            const messages = document.getElementById('socialMessages').value.trim();
            const communityPlan = document.getElementById('communityPlan').value.trim();
            
            if (!strategy || !messages || !communityPlan) {
                alert('Please complete all social media fields before submitting.');
                return;
            }
            
            mediaState.socialMediaComplete = true;
            localStorage.setItem('media_social_media_complete', 'true');
            
            // Store social media data
            const socialData = {
                strategy, messages, communityPlan,
                completedAt: new Date().toISOString()
            };
            localStorage.setItem('media_social_media_data', JSON.stringify(socialData));
            
            // Update UI
            const socialCard = document.getElementById('socialMediaForm').closest('.work-card');
            const statusBadge = socialCard.querySelector('.card-status');
            statusBadge.textContent = 'COMPLETED';
            statusBadge.className = 'card-status status-completed';
            
            showNotification('✅ Social Media Strategy completed!');
            updateOverallStatus();
            
            console.log('[Media] Social Media strategy completed');
        }

        function completeMediaOutreach() {
            const contacts = document.getElementById('mediaContacts').value.trim();
            const talkingPoints = document.getElementById('talkingPoints').value.trim();
            const monitoring = document.getElementById('monitoringPlan').value.trim();
            
            if (!contacts || !talkingPoints || !monitoring) {
                alert('Please complete all media outreach fields before submitting.');
                return;
            }
            
            mediaState.mediaOutreachComplete = true;
            localStorage.setItem('media_outreach_complete', 'true');
            
            // Store outreach data
            const outreachData = {
                contacts, talkingPoints, monitoring,
                completedAt: new Date().toISOString()
            };
            localStorage.setItem('media_outreach_data', JSON.stringify(outreachData));
            
            // Update UI
            const outreachCard = document.getElementById('mediaOutreachForm').closest('.work-card');
            const statusBadge = outreachCard.querySelector('.card-status');
            statusBadge.textContent = 'COMPLETED';
            statusBadge.className = 'card-status status-completed';
            
            showNotification('✅ Media Outreach Plan completed!');
            updateOverallStatus();
            
            console.log('[Media] Media Outreach completed');
        }

        function updateOverallStatus() {
            const mediaStatus = document.getElementById('mediaStatus');
            
            if (mediaState.pressReleaseComplete && mediaState.socialMediaComplete && mediaState.mediaOutreachComplete) {
                mediaStatus.textContent = 'Complete';
                mediaStatus.style.color = '#10b981';
                localStorage.setItem('media_team_complete', 'true');
                
                setTimeout(() => {
                    alert('🎉 Congratulations! Media Team has successfully completed all crisis communication objectives.');
                }, 1000);
            } else {
                const completed = [mediaState.pressReleaseComplete, mediaState.socialMediaComplete, mediaState.mediaOutreachComplete].filter(Boolean).length;
                mediaStatus.textContent = `${completed}/3 Complete`;
            }
        }

        function showNotification(message) {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');
                setTimeout(() => {
                    notification.remove();
                }, 400);
            }, 4000);
        }

        // Check for Crisis Analysis completion (for status updates)
        function checkCrisisAnalysisStatus() {
            const crisisComplete = localStorage.getItem('crisis_analysis_complete');
            if (crisisComplete === 'true') {
                document.getElementById('crisisStatus').textContent = 'Complete';
                document.getElementById('crisisStatus').style.color = '#10b981';
            }
        }

        // Initial check for crisis analysis
        checkCrisisAnalysisStatus();

        // CEO Dashboard Integration (receives broadcasts)
        window.addEventListener('storage', function(e) {
            if (e.key === 'ceo_broadcast') {
                const broadcast = JSON.parse(e.newValue);
                showNotification('📢 CEO: ' + broadcast.message);
            }
        });

        // Emergency reset (hidden feature for instructor)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                if (confirm('Reset Media Team interface? This will clear all data.')) {
                    localStorage.removeItem('media_draft');
                    localStorage.removeItem('media_press_release_complete');
                    localStorage.removeItem('media_social_media_complete');
                    localStorage.removeItem('media_outreach_complete');
                    localStorage.removeItem('media_team_complete');
                    location.reload();
                }
            }
        });
    </script>
</body>
</html>
